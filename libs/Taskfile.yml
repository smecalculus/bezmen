version: '3'

set: [pipefail]

vars:
  SHARED_REVISION:
    sh: git write-tree --prefix=shared
  SHARED_REV: '{{.SHARED_REVISION | trunc 7}}'
  SHARED_VERSION: 0.1.0-{{.SHARED_REV}}

includes:
  schema:
    taskfile: schema/Taskfile.yml
    dir: schema

tasks:
  binary:
    run: once
    status:
      - test -f target/pom-resolved-{{.SHARED_VERSION}}.xml
    cmds:
      - find . -name "*.jar" -type f -delete
      - find . -name "pom-resolved*.xml" -type f -delete
      - mvn install -am -T1C -Drevision={{.SHARED_VERSION}}

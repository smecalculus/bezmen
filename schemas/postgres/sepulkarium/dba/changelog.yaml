databaseChangeLog:
  - logical-file-path: dba/changelog.yaml
  - property:
      name: author
      value: dba
  - changeSet:
      id: database-${database.name}
      author: ${author}
      runAlways: true
      validCheckSum: ANY
      runInTransaction: false
      labels: database
      preConditions:
        - onFail: CONTINUE
        - sqlCheck:
            expectedResult: 0
            sql: SELECT count(*) FROM pg_database WHERE datname = '${database.name}'
      changes:
        - sqlFile:
            path: database.sql
            relativeToChangeLogFile: true
            splitStatements: true
  - changeSet:
      id: user-${owner.name}
      author: ${author}
      runAlways: true
      runInTransaction: true
      validCheckSum: ANY
      labels: user
      preConditions:
        - onFail: CONTINUE
        - sqlCheck:
            expectedResult: 0
            sql: SELECT count(*) FROM pg_roles WHERE rolname = '${owner.name}'
      changes:
        - sqlFile:
            path: user.sql
            relativeToChangeLogFile: true
            splitStatements: false
  - changeSet:
      id: schema-${schema.name}
      author: ${author}
      runAlways: true
      runInTransaction: true
      validCheckSum: ANY
      labels: schema
      preConditions:
        - onFail: CONTINUE
        - sqlCheck:
            expectedResult: 0
            sql: SELECT count(*) FROM pg_namespace WHERE nspname = '${schema.name}'
      changes:
        - sqlFile:
            path: schema.sql
            relativeToChangeLogFile: true
            splitStatements: true

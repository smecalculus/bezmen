---
- name: Build
  ansible.builtin.command:
    cmd: >-
      mvn {{ maven_phase|mandatory }}
        --activate-profiles {{ devenv }}
        --no-snapshot-updates
        --batch-mode
        --fail-fast
        --also-make
        --threads 2
        --projects {{
          product.libs
          | map(attribute='name')
          | map('regex_replace', '^', ':')
          | join(',')
        }}
        --define revision={{ binary_tag }}
    chdir: "{{ project.dir }}"
    strip_empty_ends: false
  changed_when: true

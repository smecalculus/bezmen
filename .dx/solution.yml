---
- import_playbook: images.yml  # noqa: name[play]
  tags: [images, deps]

- name: Solution
  hosts: solution
  run_once: true
  tasks:
    - name: Capture solution status
      ansible.builtin.import_tasks:
        file: tasks/solution/status.yml
      tags: [always]
    - name: Capture pipeline status
      ansible.builtin.import_tasks:
        file: tasks/pipeline/status.yml
      tags: [always]
    - name: Compile solution
      ansible.builtin.import_tasks:
        file: tasks/solution/compile.yml
      tags: [compile]
      when: >
        solution_status is changed or
        pipeline_status is changed
    - name: Test solution
      ansible.builtin.import_tasks:
        file: tasks/solution/test.yml
      tags: [test]
      when: >
        solution_status is changed or
        pipeline_status is changed
    - name: Package solution
      ansible.builtin.import_tasks:
        file: tasks/solution/package.yml
      tags: [package]
      when: solution_status is changed
    - name: Package pipeline
      ansible.builtin.import_tasks:
        file: tasks/pipeline/package.yml
      tags: [package]
      when: pipeline_status is changed

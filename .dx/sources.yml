---
- name: Sources
  hosts: lib
  tasks:
    - name: Analyze
      ansible.builtin.command:
        cmd: >
          mvn
          --no-snapshot-updates
          --batch-mode
          {% if is_local_building %}
          spotless:apply
          {% else %}
          spotless:check
          {% endif %}
          enforcer:enforce
        chdir: "{{ playbook_dir }}/../libs"
        strip_empty_ends: false
      changed_when: false

- name: Sources
  hosts: app
  tasks:
    - name: Analyze
      ansible.builtin.command:
        cmd: >
          mvn
          --no-snapshot-updates
          --batch-mode
          {% if is_local_building %}
          spotless:apply
          {% else %}
          spotless:check
          {% endif %}
        chdir: "{{ playbook_dir }}/../apps"
        strip_empty_ends: false
      changed_when: false

- name: Sources
  hosts: test
  tasks:
    - name: Analyze
      ansible.builtin.command:
        cmd: >
          mvn
          --no-snapshot-updates
          --batch-mode
          {% if is_local_building %}
          spotless:apply
          {% else %}
          spotless:check
          {% endif %}
        chdir: "{{ playbook_dir }}/../tests"
        strip_empty_ends: false
      changed_when: false

- name: Sources
  hosts: dx
  tasks:
    - name: Analyze
      ansible.builtin.command:
        # list all top level playbooks
        cmd: >
          ansible-lint
          sources.yml
          stack.yml
          pipeline.yml
        strip_empty_ends: false
      changed_when: false

- name: Sources
  hosts: pipeline
  tasks:
    - name: Analyze
      ansible.builtin.command:
        cmd: yamllint ../.github
        strip_empty_ends: false
      changed_when: false

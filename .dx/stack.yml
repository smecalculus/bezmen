---
- import_playbook: images.yml
  tags: [images, deps]

- hosts: stack
  run_once: yes
  tasks:
    - import_tasks:
        file: tasks/pipeline/status.yml
      tags: [always]
    - import_tasks:
        file: tasks/stack/status.yml
      tags: [always]
    - import_tasks:
        file: tasks/stack/compile.yml
      tags: [compile]
      # remotely compile stack even if it hasn't changed (it's fast enough)
      when: >
        is_remote_building or
        stack_status is changed
    - import_tasks:
        file: tasks/stack/test.yml
      tags: [test]
      when: >
        stack_status is changed or
        pipeline_status is changed
    - import_tasks:
        file: tasks/stack/package.yml
      tags: [package]
      when: stack_status is changed
